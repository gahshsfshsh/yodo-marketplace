@echo off
chcp 65001 >nul
echo.
echo ========================================
echo   üîç –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
echo ========================================
echo.

set SERVER_USER=Tema
set SERVER_IP=188.68.223.230

echo –°–µ—Ä–≤–µ—Ä: %SERVER_USER%@%SERVER_IP%
echo.

echo [1/4] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ (ping)...
ping -n 3 %SERVER_IP%

if errorlevel 1 (
    echo ‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!
    echo –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
    pause
    exit /b 1
) else (
    echo ‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
)

echo.
echo [2/4] –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ—Ä—Ç–∞ (22)...
powershell -Command "Test-NetConnection -ComputerName %SERVER_IP% -Port 22"

echo.
echo [3/4] –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SSH...
echo (–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –µ—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç)
echo.

ssh -o ConnectTimeout=10 %SERVER_USER%@%SERVER_IP% "echo '‚úÖ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!' && hostname && pwd && ls -la"

if errorlevel 1 (
    echo.
    echo ‚ùå SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å!
    echo.
    echo –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
    echo 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
    echo 2. SSH —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
    echo 3. Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç 22
    echo.
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
    echo - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å
    echo - –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–∞
    echo.
) else (
    echo.
    echo ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
    echo.
)

echo.
echo [4/4] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...
ssh %SERVER_USER%@%SERVER_IP% "ls -la /home/Tema/yodo/ 2>&1 || echo '–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'"

echo.
echo ========================================
echo   –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞
echo ========================================
echo.
echo –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, –º–æ–∂–µ—Ç–µ:
echo 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å: SETUP_SERVER.bat
echo 2. –ó–∞—Ç–µ–º: DEPLOY_FIXED.bat
echo.

pause

